@page "/"
@inject BlazorServerUI.Services.IApiService ApiService
@rendermode InteractiveServer
@using System.Text.Json

<h2>Blazor Server Home Page</h2>
<p>Welcome to the Blazor Server application. Use the buttons below to interact with the API and see the results.</p>

<div>
    <h3>API Interactions</h3>
    <p>Click the buttons below to fetch data from the API or send data to the API.</p>
    <!-- Button to fetch data from the API -->
    <button @onclick="GetApiData">Get API Data</button>
    <!-- Button to send data to the API -->
    <button @onclick="PostApiData">Post API Data</button>
</div>

@if (isLoading)
{
    <!-- Display loading message while data is being fetched or sent -->
    <p>Loading...</p>
}
else if (apiResponse != null)
{
    <div>
        <h3>API Response</h3>
        <!-- Display the API response -->
        <pre>@apiResponse</pre>
    </div>
}

@code {
    // Variable to store the API response
    private string? apiResponse;
    // Flag to indicate if a request is in progress
    private bool isLoading = false;

    // Method to fetch data from the API
    private async Task GetApiData()
    {
        isLoading = true;
        try
        {
            // Call the API service to get data
            var data = await ApiService.GetApiDataAsync();
            // Serialize the data to JSON format for display
            apiResponse = JsonSerializer.Serialize(data, new JsonSerializerOptions { WriteIndented = true });
        }
        finally
        {
            isLoading = false;
        }
    }

    // Method to send data to the API
    private async Task PostApiData()
    {
        isLoading = true;
        try
        {
            // Data to be sent to the API
            var data = "Hello from Blazor Server";
            // Call the API service to post data
            var response = await ApiService.PostApiDataAsync(data);
            // Serialize the response to JSON format for display
            apiResponse = JsonSerializer.Serialize(response, new JsonSerializerOptions { WriteIndented = true });
        }
        finally
        {
            isLoading = false;
        }
    }
}